name: Verify Build

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  verify-build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Build project
      run: npm run build
    
    - name: Verify build output
      run: |
        echo "Checking build output..."
        
        # Check if dist/index.html exists
        if [ ! -f "dist/index.html" ]; then
          echo "❌ ERROR: dist/index.html does not exist!"
          exit 1
        fi
        echo "✅ dist/index.html exists"
        
        # Check if index.html references source files (should not)
        if grep -q "/src/main.jsx" dist/index.html || grep -q "/src/main.js" dist/index.html; then
          echo "❌ ERROR: index.html still references source files (/src/main.jsx)"
          echo "   The build output should reference compiled assets in /assets/"
          exit 1
        fi
        echo "✅ index.html references compiled assets"
        
        # Check if dist/assets directory exists
        if [ ! -d "dist/assets" ]; then
          echo "❌ ERROR: dist/assets/ directory does not exist!"
          exit 1
        fi
        echo "✅ dist/assets/ directory exists"
        
        # Check if there are JS files in assets
        JS_COUNT=$(find dist/assets -name "*.js" -type f | wc -l)
        if [ "$JS_COUNT" -eq 0 ]; then
          echo "❌ ERROR: No JavaScript files found in dist/assets/"
          exit 1
        fi
        echo "✅ Found $JS_COUNT compiled JavaScript file(s)"
        
        # Check if _redirects exists
        if [ -f "dist/_redirects" ]; then
          echo "✅ dist/_redirects exists"
        else
          echo "⚠️  WARNING: dist/_redirects not found (may be needed for SPA routing)"
        fi
        
        echo ""
        echo "✅ Build verification passed!"

